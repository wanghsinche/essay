# 从威尼斯人的赌桌到宽基ETF
> -- 不做概率计算的韭菜不是好韭菜 

## 一
今年4月底，趁着部门到珠海团建的机会，我和两个同事一起溜去澳门逛逛。初到澳门，少不了进赌场试试水，我们也未能免俗。在纠结 了半小时之后，三个人决定按照有限合伙的原则，各自出一百港币，凑够最低下注的赌资，押一波大小。

韭菜的运气总是很差，三百块一把亏完。在骂了一声“擦！体验真差！”后，我们匆匆离场。

之所以提起这段往事，主要是当时下注的同事做出一个很“骚”的操作。威尼斯人的赌桌旁边有一个历史记分板，会显示最近10次赌局的结果。当时记分板上“大”和“小"的频率比是7/3，刚好那个同事入门了一点机器学习，只看到贝叶斯分析那章。于是他按照所谓的先验信息，决定买大--毕竟前面好几次都开的大，凭什么这次不是！

## 二
一般人可能会说，骰子开出大和小的概率肯定是3/3，都开了那么多大了，还买大，脑子呢。但是理论上讲，那个同事也不是没道理。从 贝叶斯分析的观点看，前面那么多大，凭什么认为骰子开出大和小概率相等，说不定骰子就是质量有问题呢，说不定是庄家有鬼呢。

而且即使骰子和庄家都没问题，开出大小的理论概率是3/3，也不能认为之前10次开了7次大，这次小的概率会更高。因为掷骰子每一次的结果都是独立，与前面发生的事件无关。这就像我家对面那家人一样，他们连续生了8个女儿，本着生男生女概率是一样的科学原理，怀 了第九个小孩，结果还是女的。-- 讲真，我觉得我家对面那家人应该学点贝叶斯分析，他们就会觉得既然之前都是女孩了，那这次生女 孩的概率也许真的很大。

这些问题都可以看成一类时间序列问题，每个时刻发生不同事件（进入不同的状态）。如果假设下一刻发生的事件（即进入的状态）只与当下的状态有关，与之前的状态无关，那么一个很强大的数学工具--马尔可夫链可以对这类问题做出很好的描述。

至此，这些云里雾里的问题先放一边，毕竟我是想写写最近悟到的一个交易理论。

## 三
我要是说交易，不论是美股，a股，期货，外汇，数字货币，都是在赌博。价投（价值投资）大师们一定会很不屑，一个月前的我也很不 屑--说别的交易是在赌博，大部分价投可能暗自点头，但是要是说买股票是在赌博，价投们总会有各种理论反驳，譬如“茅台就是好啊，盈利年年增长，穿越周期。中国平安一本万利，在通货膨胀和老龄化的大环境下，基业长青。至于京东，大强子进去后各种裁员，精兵简政，轻装上阵，市值绝对触底反弹”。

呸，茅台那么好，为什么去年破600没人买，京东从高点跌掉30%时价投们又在哪里。

市场上有一句至理--“顺势而为”。不要在破位的时候冲去接盘，也不要在美股天天新高的时候赶着做空。趋势的力量是强大的，它能让一个优质公司的市值跌到谷底，也可以让一个连年亏损的企业因为一两句传言不断上涨。问题是，赌徒有没有可能抓住趋势，从此发家致富？我表示，这不确定。

## 四
“你要寻找的是标错赔率的赌局”--《穷查理宝典》查理·芒格

让我们回到赌场上，理智点的人都知道赌徒长远来看必定亏光，因为他盈利的数学期望小于0。假如能找到一个扣除掉各种成本，盈利数 学期望还是大于0的赌局，那么不断砸钱进去理论上是会发家致富的。澳门威尼斯人赌场是别想了，但是其他赌场呢，比如说各个交易市 场。

靠交易出名的人数不胜数，巴菲特，芒格，菲利普费雪，被交易坑死的人也一堆，牛顿，各种韭菜，以及我自己。

基于这些事实，只能做出一个假设，在交易这个赌场里，存在一些数学期望大于零的赌局。这样才能解释历史上能流传出这么多大佬的事迹，他们活得又长又滋润，吸引着一波又一波的韭菜。

## 五
根据上面的假设，可以做出一个推论，只要找到一些扣除掉交易成本，盈利数学期望依然大于零的交易，就有利可图。这又引出一个问题，把每次交易看成一次下注，把交易对象看成赌局，那么这个局的输赢比和赔率又分别是什么呢。

在考虑了众多因素之后，我将**交易对象在买入后一段时间内最高涨到某区间或者最低跌到某区间**看成一次**赌局的结束**。对应**上涨和下跌的概率就是输赢比**。这里的区间单位用平均真值ATR计量。这样选择的原因见[FAQ](#FAQ)。

我一般只买卖股票和ETF，所以接下来默认只讨论股票。

那么交易规则就是：
- 对市场上部分股票进行计算，比如上证50，比如大消费行业。这些票的历史表现不错，说明他们的盈利期望都不错，可以减少计算成本。
- 经过层层“计算”之后，得到这些票的上涨下跌概率和对应区间。此处的“计算”是一个抽象名称，后续会有详细讨论其有效性和方式。
- 选出期望最高的票，留出一点点仓位（理由见[FAQ](#FAQ)），几乎全仓买入。
- 一直持有，直到价格触碰到上涨or下跌的区间，或者到达预测的时间终点。
- 到达预测区间后立刻卖出（讨论见[FAQ](#FAQ)），到达预测时间终点也应该卖出。等待股价走完整个预测时间段，然后复盘。根据结 果修正计算模型。

## 六
至此，可以发现，这套理论的关键在于“计算”股票在一段时间内上涨下跌的概率和区间极值。有人会说，这不就是在预测股价，预测未来么？伪科学！

等等，为什么预测未来就是伪科学？天气预报，道路流量预测，输入法单词预测，广告收入预测，这些都是预测未来，而且已经在大规模应用。

关于股票运行区间的预测，业内一直存在有效市场和非有效市场的争论，以及随机漫步的说法。对此我只能相信，这个市场是非有效市场，至少短期内是，因为每个人获取信息的能力是不一样的。事件的发生到价格出反应存在时间差。而价格是随机漫步的观点也无非否认运行区间预测的作用，只是最终预测出来的上涨和下跌概率，以及最终区间都是相同的，期望为0。（讨论见[FAQ](#FAQ)）

计算的方法有很多种。看研报，财报计算出股价变化的区间，结合市场情绪算出概率是一种计算。用技术指标进行分析也是计算。搞自相关波形预测，小波分析，傅里叶变换之类的也算。只不过我觉得用机器学习的方式是最靠谱的。因为时间序列预测，在自然语言处理NLP 领域有很多成熟和强大的方法。

但是计算的关键是必须得到某段时间内**价格变化区间**和**相应概率**。缺一不可。

## 七
写到这里，这篇日志就算结束了。

没有任何实际操作，只是提出了一个大方向。接下来日子，就是去构建这个系统了。理论上适应大部分交易市场，但我还是决定先选择流动性强宽基ETF，一方面交易费用小，其次价格与主要指数相关，不受操控，减少人为干涉对预测的影响，三是宽基ETF价格变动较小，实际交易时滑点小，毕竟我还是人工下单呐。

感谢素婷这些天一直听我BB，而且教了我很多名称和概念。

愿世界和平。

以上。


## FAQ
1. 输赢为什么不是简单的上涨和下跌，而是规定为到某个区间？
- 只是预测上涨和下跌无法计算赔率，也就意味着无法获利。比如计算出上涨概率90%，下跌概率10%，那么要下多少注才能取得正的数学期望呢？
2. 为什么选择ATR作为区间单位？
- ATR，平均真值，代表了标的每日的波动范围，比上涨和下跌幅度更能代表一个票内在的波动性。而且用ATR很容易计算出每一次下注总账户会变化多少，有利于风控。
3. 为什么是全仓买入，为什么不分批买入，为什么要留一点仓位？
- 分批买入就是下注策略的范畴了，常见的下注法有凯利公式，马丁格尔（Martingale）下注，倒三角形下注，定投等等。这些下注法的优劣在wiki都有，马丁格尔的详见wiki **鞅 (概率论)** 的词条。
- 对于一个知道概率和赔率的赌局，我不觉得全仓买入有什么不好。凯利公式也确实不错，可以考虑一下，而其他的策略都被数学证明无效了，无需考虑。
- 留仓位是因为一旦开局不利，能投入的钱就会越来越少，导致赚钱的难度越来越高。所以需要留一点仓位，保证每次下注都能投入一样多的钱。大概等于亏的数学期望的数倍即可，也算是一个风控。一旦没有剩余仓位了，说明一直预测失败，或者有特殊情况出现，必须停止游戏。
4. 到达预测区间后是否应该卖出？
- 从模型有效的角度，到达区间都应该卖出。因为运行到此处已经无法确定模型是否有效。万一突破区间，都代表了模型本次预测失败。在模型预测失败的情况下继续持有代表了未知，非常危险。
- 下跌到预测区间自然应该卖出，从风险的角度看也是如此。但是上涨突破预测区间也应该卖出吗？如果一直在区间内运行，是不是可以不卖，等到走完整个预测时间段？如果上涨突破区间，是不是也可以一直持有？这些情况都值得讨论，但是我倾向于卖出，之后进行新一轮预测。
5. 价格区间的可预测性？
- 现实世界的规律都有适用尺度。海面在地理尺度上近似一个球面，在土木工程的角度上是一个海平面。牛顿定理在微观和高速领域都不适用。股票价格区间的预测性也是，如果把某个区间内的股票看成**时不变系统**，那么该价格就是预测的。
- 如果有随机事件的发生导致到价格突破预测区间，那就代表了本次预测失败，游戏结束。出现这种情况必须复盘，找到失败原因，并考虑是否加入模型。但本质上讲，原先的模型和依赖的假设没错。
